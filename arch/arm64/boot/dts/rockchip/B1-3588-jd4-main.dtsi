// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2021 Rockchip Electronics Co., Ltd.
 *
 */

#include "core-3588-jd4.dtsi"


 / {
/* led */
	firefly_leds: leds {
		power_led: power {
			gpios = <&gpio1 RK_PA5 GPIO_ACTIVE_LOW>;//green led
            default-state = "on";
		};

		// user_led: user {
		// 	gpios = <&pca9555 PCA_IO0_3 GPIO_ACTIVE_HIGH>; //yellow led
        //     default-state = "off";
		// };
	};

	// firefly_leds: leds {
	// 	compatible = "gpio-leds";
	// 	status = "okay";
	// 	power_led: power {
	// 		label = ":power"; //green led
	// 		linux,default-trigger = "ir-power-click";
	// 		default-state = "on";
	// 		gpios = <&gpio1 RK_PB3 GPIO_ACTIVE_HIGH>;
	// 	};

	// 	user_led: user {
	// 		label = ":user"; //yellow led
	// 		linux,default-trigger = "ir-user-click";
	// 		default-state = "off";
	// 		gpios = <&pca9555 PCA_IO0_3 GPIO_ACTIVE_HIGH>;
	// 	};
	// };

	fan: pwm-fan {
		compatible = "pwm-fan";
		#cooling-cells = <2>;
		fan-supply = <&vcc12v_dcin>;
		pwms = <&pwm13 0 50000 1>;
	};


	adc_keys: adc-keys {
		status = "okay";
		compatible = "adc-keys";
		io-channels = <&saradc 1>;
		io-channel-names = "buttons";
		keyup-threshold-microvolt = <1800000>;
		poll-interval = <100>;

		recovery-key{
			label = "F12";
			linux,code = <KEY_F12>;
			press-threshold-microvolt = <17000>;
		};
	};

	vcc3v3_pcie30: vcc3v3-pcie30 {
		compatible = "regulator-fixed";
		regulator-name = "vcc3v3_pcie30";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		enable-active-high;
		gpios = <&gpio2 RK_PC5 GPIO_ACTIVE_HIGH>;
		startup-delay-us = <5000>;
		vin-supply = <&vcc12v_dcin>;
		status = "disabled";
	};

	pcie30_avdd1v8: pcie30-avdd1v8 {
		compatible = "regulator-fixed";
		regulator-name = "pcie30_avdd1v8";
		regulator-boot-on;
		regulator-always-on;
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		vin-supply = <&avcc_1v8_s0>;
	};

	pcie30_avdd0v75: pcie30-avdd0v75 {
		compatible = "regulator-fixed";
		regulator-name = "pcie30_avdd0v75";
		regulator-boot-on;
		regulator-always-on;
		regulator-min-microvolt = <750000>;
		regulator-max-microvolt = <750000>;
		vin-supply = <&avdd_0v75_s0>;
	};

	/* If hdmirx node is disabled, delete the reserved-memory node here. */
	reserved-memory {
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

		/* Reserve 256MB memory for hdmirx-controller@fdee0000 */
		cma {
			compatible = "shared-dma-pool";
			reusable;
			reg = <0x0 (256 * 0x100000) 0x0 (256 * 0x100000)>;
			linux,cma-default;
		};
	};
};

&i2s0_8ch {
	status = "disabled";
	pinctrl-0 = <&i2s0_lrck
				&i2s0_sclk
				&i2s0_sdi0
				&i2s0_sdo0>;
};

&i2s5_8ch {
	status = "okay";
};

&gmac1 {
	/* Use rgmii-rxid mode to disable rx delay inside Soc */
	phy-mode = "rgmii-rxid";
	clock_in_out = "output";

	snps,reset-gpio = <&gpio3 RK_PB7 GPIO_ACTIVE_LOW>;
	snps,reset-active-low;
	/* Reset time is 20ms, 100ms for rtl8211f */
	snps,reset-delays-us = <0 20000 100000>;

	pinctrl-names = "default";
	pinctrl-0 = <&gmac1_miim
			&gmac1_tx_bus2
			&gmac1_rx_bus2
			&gmac1_rgmii_clk
			&gmac1_rgmii_bus>;

	tx_delay = <0x42>;
	//rx_delay = <0x4f>;

	phy-handle = <&rgmii_phy1>;
	status = "disbaled";
};

&mdio1 {
	rgmii_phy1: phy@1 {
		compatible = "ethernet-phy-ieee802.3-c22";
		reg = <0x1>;
	};
};

&u2phy0_otg {
	rockchip,typec-vbus-det;
};

&usbdrd_dwc3_0 {
	dr_mode = "otg";
	usb-role-switch;
	port {
		#address-cells = <1>;
		#size-cells = <0>;
	};
};

&usbhost3_0 {
	status = "okay";
};

&usbhost_dwc3_0 {
	status = "okay";
};

&u2phy0 {
	status = "okay";
};

&u2phy2 {
	status = "okay";
};

&u2phy3 {
	status = "okay";
};

&u2phy0_otg {
	status = "okay";
};

&u2phy2_host {
	status = "okay";
};

&u2phy3_host {
	status = "okay";
};

&usb_host0_ehci {
	status = "okay";
};

&usb_host0_ohci {
	status = "okay";
};

&usb_host1_ehci {
	status = "okay";
};

&usb_host1_ohci {
	status = "okay";
};


&usbdp_phy0 {
	status = "okay";
	orientation-switch;
	svid = <0xff01>;
	sbu1-dc-gpios = <&gpio4 RK_PA6 GPIO_ACTIVE_HIGH>;
	sbu2-dc-gpios = <&gpio4 RK_PA7 GPIO_ACTIVE_HIGH>;

	port {
		#address-cells = <1>;
		#size-cells = <0>;
	};
};

&usbdp_phy0_dp {
	status = "okay";
};

&usbdrd3_0 {
	status = "okay";
};

&usbdrd_dwc3_0 {
	dr_mode = "otg";
	status = "okay";
};

&i2s6_8ch {
	status = "okay";
};

&i2s7_8ch {
	status = "okay";
};

&usbdp_phy1 {
	rockchip,dp-lane-mux = <2 3>;
	status = "disabled";
};

&gmac0 {
	/* Use rgmii-rxid mode to disable rx delay inside Soc */
	phy-mode = "rgmii-rxid";
	clock_in_out = "output";

	snps,reset-gpio = <&gpio3 RK_PC7 GPIO_ACTIVE_LOW>;
	snps,reset-active-low;
	/* Reset time is 20ms, 100ms for rtl8211f */
	snps,reset-delays-us = <0 20000 100000>;

	pinctrl-names = "default";
	pinctrl-0 = <&gmac0_miim
			&gmac0_tx_bus2
			&gmac0_rx_bus2
			&gmac0_rgmii_clk
			&gmac0_rgmii_bus>;

	tx_delay = <0x45>;
	//rx_delay = <0x4a>;

	phy-handle = <&rgmii_phy0>;
	status = "disbaled";
};

&mdio0 {
	rgmii_phy0: phy@1 {
		compatible = "ethernet-phy-ieee802.3-c22";
		reg = <0x1>;
	};
};

&u2phy1_otg {
	/delete-property/ phy-supply;
};

&u2phy1 {
	status = "okay";
};

&u2phy1_otg {
	status = "okay";
};

&usbdp_phy1 {
	status = "okay";
};

&usbdp_phy1_dp {
	status = "okay";
};

&usbdp_phy1_u3 {
	status = "okay";
};

&usbdrd3_1 {
	status = "okay";
};

&usbdrd_dwc3_1 {
	status = "okay";
};

&combphy2_psu{
        status = "okay";
};

// /* gamc0 */
&gmac0 {
	/* Use rgmii-rxid mode to disable rx delay inside Soc */
	phy-mode = "rgmii-rxid";
	clock_in_out = "output";

	snps,reset-gpio = <&gpio4 RK_PA2 GPIO_ACTIVE_LOW>;
	snps,reset-active-low;
	/* Reset time is 20ms, 100ms for rtl8211f */
	snps,reset-delays-us = <0 20000 100000>;

	pinctrl-names = "default";
	pinctrl-0 = <&gmac0_miim
			&gmac0_tx_bus2
			&gmac0_rx_bus2
			&gmac0_rgmii_clk
			&gmac0_rgmii_bus>;

	tx_delay = <0x45>;
	//rx_delay = <0x4a>;

	phy-handle = <&rgmii_phy0>;
	status = "okay";
};

&gmac0_tx_bus2{
    rockchip,pins =
    /* gmac0_txd0 */
    <2 RK_PB6 1 &pcfg_pull_up_drv_level_6>,
    /* gmac0_txd1 */
    <2 RK_PB7 1 &pcfg_pull_up_drv_level_6>,
    /* gmac0_txen */
    <2 RK_PC0 1 &pcfg_pull_none>;
};

&gmac0_rgmii_bus{
	rockchip,pins =
	/* gmac0_rxd2 */
	<2 RK_PA6 1 &pcfg_pull_none>,
	/* gmac0_rxd3 */
	<2 RK_PA7 1 &pcfg_pull_none>,
	/* gmac0_txd2 */
	<2 RK_PB1 1 &pcfg_pull_up_drv_level_6>,
	/* gmac0_txd3 */
	<2 RK_PB2 1 &pcfg_pull_up_drv_level_6>;
};

/* gmac1 */
&gmac1 {
	snps,reset-gpio = <&gpio4 RK_PB5 GPIO_ACTIVE_LOW>;
	tx_delay = <0x45>;
	status = "okay";
};

&gmac1_tx_bus2{
	rockchip,pins =
	/* gmac1_txd0 */
	<3 RK_PB3 1 &pcfg_pull_up_drv_level_6>,
    /* gmac1_txd1 */
	<3 RK_PB4 1 &pcfg_pull_up_drv_level_6>,
	/* gmac1_txen */
	<3 RK_PB5 1 &pcfg_pull_none>;
};

&gmac1_rgmii_bus{
	rockchip,pins =
	/* gmac1_rxd2 */
	<3 RK_PA2 1 &pcfg_pull_none>,
	/* gmac1_rxd3 */
	<3 RK_PA3 1 &pcfg_pull_none>,
	/* gmac1_txd2 */
	<3 RK_PA0 1 &pcfg_pull_up_drv_level_6>,
	/* gmac1_txd3 */
	<3 RK_PA1 1 &pcfg_pull_up_drv_level_6>;
};


&pwm5 {
	pinctrl-0 = <&pwm5m1_pins>;
	status = "okay";
};

// fan
&pwm13 {
	pinctrl-0 = <&pwm13m0_pins>;
	status = "okay";
};


/* tf-card */
&sdmmc {
	status = "okay";
};

&usbdrd3_0 {
	status = "okay";
};

// 双层USB的下面 // type-c0
// usb@fc000000
&usbdrd_dwc3_0{
	//dr_mode = "host";"peripheral";
	dr_mode = "peripheral";
	phys = <&u2phy0_otg>, <&usbdp_phy0_u3>;
    status = "okay";
};

&mdio0 {
	rgmii_phy0: phy@1 {
		compatible = "ethernet-phy-ieee802.3-c22";
		reg = <0x1>;
	};
};

&u2phy0_otg {
    status = "okay";
};


&usbdp_phy0_u3 {
	status = "okay";
};



// --------------

// &usbdrd3_1 {
// 	status = "okay";
// };


// //上面
&usbdrd_dwc3_1 {
	// dr_mode = "host";
	phys = <&u2phy1_otg>, <&usbdp_phy1_u3>;
    status = "okay";
};

&u2phy1_otg {
	/delete-property/ phy-supply;
    status = "okay";
};

// &usbdp_phy1_u3 {
//     status = "okay";
// };


&u2phy2_host {
        // phy-supply = <&USB30_HUB_RST>;
        /delete-property/ phy-supply;
        status = "okay";
};


&u2phy3_host {
        // phy-supply = <&USB30_HUB_RST>;
        /delete-property/ phy-supply;
        status = "okay";
};

/* XL9555*/

// &i2c6 {
// 	/delete-node/ pca9555;
// };

&i2c3 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&i2c3m2_xfer>;
		// clock-frequency = <400000>;

	xl9555_1: gpio@20 {
		status = "okay";
		compatible = "nxp,pca9555";
		reg = <0x20>;
		gpio-controller;
		#gpio-cells = <2>;
		gpio-group-num = <200>;
	};

	xl9555_2: gpio@22 {
		status = "okay";
		compatible = "nxp,pca9555";
		reg = <0x22>;
		gpio-controller;
		#gpio-cells = <2>;
		gpio-group-num = <300>;
	};

	pc9202: pc9202@3c {
		status = "okay";
		compatible = "firefly,pc9202";
		reg = <0x3c>;
		wd-en-gpio = <&gpio3 RK_PC4 GPIO_ACTIVE_HIGH>;         // GPIO3_C4
		pinctrl-names = "default";
		pinctrl-0 = <&wdt_ctl1>;
		driver-names = "wdtdiban";
	};
};

// sata
&pcie2x1l0 {
	status = "disabled";
};

&sata1 {
	status = "okay";
};

&combphy1_ps {
	status = "okay"; 
};
// sata end

&combphy0_ps{
	status = "okay";
};

/* can1 */
&can1 {
	status = "okay";
	assigned-clocks = <&cru CLK_CAN1>;
	assigned-clock-rates = <200000000>;
	pinctrl-names = "default";
	pinctrl-0 = <&can1m1_pins>;
};

/* RS485 */
&uart1{
	pinctrl-0 = <&uart1m1_xfer>;
	status = "okay";
};

/* RS232 */
&uart7{
	pinctrl-0 = <&uart7m1_xfer>;
	status = "okay";
};


/* pinctrl */
&pinctrl {
	watchdog {
		wdt_ctl1: wdt-ctl {
				rockchip,pins =
				<3 RK_PC4 RK_FUNC_GPIO &pcfg_pull_none>;            //GPIO3_C4
		};
	};

	pcie {
		pcieclk_gpio: pcieclk-gpio {
			/* led_power */
			rockchip,pins = <3 22 RK_FUNC_GPIO &pcfg_pull_down>,
							<3 21 RK_FUNC_GPIO &pcfg_pull_down>,
							<4 14 RK_FUNC_GPIO &pcfg_pull_down>;

		};
 	};

	headphone {
		hp_det: hp-det {
			rockchip,pins = <2 RK_PC3 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	sata {
		sata_reset:sata-reset{
			rockchip,pins = <4 RK_PC1 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

};
